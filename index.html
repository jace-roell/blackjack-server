<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blackjack Game</title>
  <style>
    /* Add some basic styling for the UI */
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
    }
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    .game-info {
      margin-bottom: 20px;
    }
    .buttons {
      display: flex;
      justify-content: space-between;
      max-width: 300px;
      margin: 10px auto;
    }
    .hand {
      font-size: 18px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="game-info">
      <h1>Blackjack Game</h1>
      <p>Player Balance: $<span id="player-balance">1000</span></p>
      <p>Bet: $<input type="number" id="player-bet" min="20" step="1" value="20"></p>
      <button id="start" onclick="startGame()">Start</button>
    </div>
    <div class="buttons">
      <button id="hit" onclick="playerHit()" disabled>Hit</button>
      <button id="stand" onclick="playerStand()" disabled>Stand</button>
      <button id="double" onclick="doubleDown()" disabled>Double Down</button>
      <button id="split" onclick="splitHand()" disabled>Split</button>
    </div>
    <div class="hand">
      <p id="player-hand">Player's hand: </p>
      <p id="dealer-hand">Dealer's hand: </p>
    </div>
    <p id="round-result"></p>
  </div>

  <script>
    const playerBalanceElement = document.getElementById('player-balance');
    const playerBetInput = document.getElementById('player-bet');
    const playerHandElement = document.getElementById('player-hand');
    const dealerHandElement = document.getElementById('dealer-hand');
    const roundResultElement = document.getElementById('round-result');
    const startButton = document.getElementById('start');
    const hitButton = document.getElementById('hit');
    const standButton = document.getElementById('stand');
    const doubleButton = document.getElementById('double');
    const splitButton = document.getElementById('split');
    
    // Set default balance to 1000
    let playerBalance = 1000;
    // Set the minimum valid bet to 20
    let playerBet = 20; 
    let playerHand = [];
    let dealerHand = [];
    let deck = [];
    let roundStarted = false;
  
    //Randomize the deck (used for when deck runs out)
    function shuffle(deck) {
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
    }
    
    //converts values of deck to numbers (K = 10, A = 1/11)
    function calculateScore(hand) {
      let score = 0;
      let numAces = 0;
  
      for (const card of hand) {
        const cardValue = card.slice(0, -1);
        const cardSuit = card.slice(-1);
  
        if (cardValue === 'A') {
          score += 11;
          numAces++;
        } else if (['K', 'Q', 'J'].includes(cardValue)) {
          score += 10;
        } else {
          score += parseInt(cardValue);
        }
      }
  
      while (score > 21 && numAces > 0) {
        score -= 10;
        numAces--;
      }
  
      return score;
    }
  
    //Display the player and dealers hands (takes second card of dealer is dependent on showHiddenCard)
    function displayHands(showHiddenCard = false) {
      playerHandElement.textContent = `Player's hand: ${playerHand.join(', ')} (Score: ${calculateScore(playerHand)})`;
      if (showHiddenCard) {
        dealerHandElement.textContent = `Dealer's hand: ${dealerHand.join(', ')} (Score: ${calculateScore(dealerHand)})`;
      } else {
        dealerHandElement.textContent = `Dealer's hand: ${dealerHand[0]}, ?`;
      }
      playerBalanceElement.textContent = playerBalance;
      playerBetInput.value = playerBet;
    }
  
    //Draw a card from the deck
    function drawCard() {
      //if deck is empty then shuffle it
      if (deck.length === 0) {
        deck = [
          '2S', '3S', '4S', '5S', '6S', '7S', '8S', '9S', '10S', 'JS', 'QS', 'KS', 'AS',
          '2H', '3H', '4H', '5H', '6H', '7H', '8H', '9H', '10H', 'JH', 'QH', 'KH', 'AH',
          '2D', '3D', '4D', '5D', '6D', '7D', '8D', '9D', '10D', 'JD', 'QD', 'KD', 'AD',
          '2C', '3C', '4C', '5C', '6C', '7C', '8C', '9C', '10C', 'JC', 'QC', 'KC', 'AC'
        ];
        shuffle(deck);
      }
      return deck.pop();
    }
  
    //start the game and confirm the bet
    function startGame() {
      if (!roundStarted) {
        const betValue = parseInt(playerBetInput.value);
        if (betValue >= 20 && betValue <= playerBalance) {
          roundStarted = true;
          startButton.disabled = true;
          hitButton.disabled = false;
          standButton.disabled = false;
          doubleButton.disabled = false;
          splitButton.disabled = false;
          
          //assign player bet and get 2 cards for each player
          playerBet = betValue;
          playerBalance -= playerBet;
          playerHand = [drawCard(), drawCard()];
          dealerHand = [drawCard(), drawCard()];
          
          // Check for blackjack
          if (calculateScore(playerHand) === 21) {
            if (calculateScore(dealerHand) === 21) {
              //Push
              endRound('Blackjack! It\'s a tie!', 0); 
            } else {
              //Win 3:2
              endRound('Blackjack! You win 1.5x!', 2.5);
            }
          } else {
            displayHands();
          }
        } else {
          alert('Please enter a valid bet between 20 and your available balance.');
        }
      }
    }
  
    function playerHit() {
      if (roundStarted) {
        playerHand.push(drawCard());
        displayHands();
        if (calculateScore(playerHand) > 21) {
           // Deduct the bet when losing (0 is the multiplier because the bet was already removed)
          endRound('Bust! You lose.', 0);
        }
      }
    }
  
    function playerStand() {
      if (roundStarted) {
         // Show the hidden card
        displayHands(true);
        while (calculateScore(dealerHand) < 17) {
          dealerHand.push(drawCard());
          // Update the dealer's hand in real-time
          displayHands(true); 
        }
        endRound();
      }
    }
  
    function doubleDown() {
      if (roundStarted && playerBalance >= playerBet) {
        playerBet *= 2;
        playerHit();
        if (calculateScore(playerHand) <= 21) {
          playerStand();
        }
      } else {
        alert('Insufficient balance to double down or round not started.');
      }
    }
  
    function splitHand() {
      if (roundStarted) {
        alert('Splitting is not implemented in this version.');
      }
    }
  
    function endRound(result = '', payoutMultiplier = 2) {
  if (roundStarted) {
     // Show the hidden card
    displayHands(true);

    if (payoutMultiplier > 0) {
      playerBalance += playerBet * payoutMultiplier;
    }

    startButton.disabled = false;
    hitButton.disabled = true;
    standButton.disabled = true;
    doubleButton.disabled = true;
    splitButton.disabled = true;

    const roundResultElement = document.createElement('p');
    roundResultElement.textContent = result;
    roundResultElement.style.fontSize = '24px';
    roundResultElement.id = 'round-result';
    document.body.appendChild(roundResultElement);

    setTimeout(() => {
      roundResultElement.remove();
      roundStarted = false;
       // Clear the hands
      displayHands();
       // Update balance
      playerBalanceElement.textContent = playerBalance;
    }, 2000);
  }
}
  </script>
</body>
</html>
